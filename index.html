<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onicotecnica Sabrina</title>
    <!-- Percorsi aggiornati -->
    <link rel="stylesheet" href="./css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="module" src="./js/supabaseClient.js"></script>
</head>
<body>
    <div class="marquee-container">
        <div class="marquee-content">
            <span><i class="fas fa-gift"></i> OFFERTA SPECIALE: Prenota online e ricevi il 10% di sconto! <i class="fas fa-gift"></i></span>
            <span><i class="fas fa-gift"></i> OFFERTA SPECIALE: Prenota online e ricevi il 10% di sconto! <i class="fas fa-gift"></i></span>
            <span><i class="fas fa-gift"></i> OFFERTA SPECIALE: Prenota online e ricevi il 10% di sconto! <i class="fas fa-gift"></i></span>
            <span><i class="fas fa-gift"></i> OFFERTA SPECIALE: Prenota online e ricevi il 10% di sconto! <i class="fas fa-gift"></i></span>
        </div>
    </div>
    <div class="popup-overlay">
        <div class="popup-content">
            <div class="popup-close">&times;</div>
            <h2>Offerta Speciale!</h2>
            <p>Prenota il tuo trattamento online e, per la prima volta, riceverai uno</p>
            <div class="popup-discount">SCONTO DEL 10%</div>
            <p>su tutti i nostri servizi!</p>
            <a href="#prenotazioni" class="popup-button">Prenota Ora</a>
        </div>
    </div>
    <header>
        <nav class="navigation">
            <h1><i class="fas fa-hand-sparkles"></i> Con Strass o Senza</h1>
            
            <button class="mobile-menu-toggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <ul class="nav-links">
                <li><a href="#servizi"><i class="fas fa-concierge-bell"></i> Servizi</a></li>
                <li><a href="#contatti"><i class="fas fa-address-card"></i> Contatti</a></li>
                <li><a href="#prenotazioni"><i class="fas fa-calendar-alt"></i> Prenotazioni</a></li>
                <li><a href="dashboard.html" class="dashboard-button"><i class="fas fa-user-cog"></i> Dashboard</a></li>
            </ul>
        </nav>
    </header>

    <section id="servizi" class="section">
        <h2>I nostri servizi</h2>
        <div class="services-container servizi-container">
            <!-- Trattamenti caricati dinamicamente -->
        </div>
    </section>

    <section id="prenotazioni" class="section">
        <h2><i class="fas fa-calendar-check"></i> Prenota un trattamento</h2>
        <form id="booking-form" class="booking-form">
            <label for="name">Nome:</label>
            <input type="text" id="name" name="name" required>
            <label for="phone">Telefono:</label>
            <input type="tel" id="phone" name="phone" required>
            <label for="date">Data:</label>
            <select id="date" name="date" required></select>
            <label for="time">Orario:</label>
            <select id="time" name="time" required>
                <option value="" disabled selected>Seleziona una data prima</option>
            </select>
            <label for="notes">Note:</label>
            <textarea id="notes" name="notes" rows="3" placeholder="Scrivi eventuali richieste o note..."></textarea>
            <div class="privacy-notice">
                <p><small>I dati personali (nome e telefono) vengono utilizzati esclusivamente dal titolare del servizio per gestire le prenotazioni e non verranno mai condivisi con terze parti. Non utilizziamo cookie di profilazione. Per maggiori informazioni contattaci.</small></p>
                <label class="privacy-consent">
                    <input type="checkbox" required name="privacy-consent">
                    Ho letto e accetto la privacy policy
                </label>
            </div>
            <button type="submit"><i class="fas fa-check-circle"></i> Prenota</button>
        </form>
        <p id="booking-message"></p>
    </section>

    <section id="contatti" class="section">
        <h2><i class="fas fa-address-card"></i> Contatti e Chi Sono</h2>
        
        <div class="contact-info">
            <div class="contact-details">
                <p><i class="fas fa-phone"></i> <a href="tel:3299362917">329 936 2917</a></p>
                <p><i class="fas fa-envelope"></i> <a href="mailto:sabrypalermo00@gmail.com">sabrypalermo00@gmail.com</a></p>
            </div>
    
            <div class="about-me">
                <h3>Chi Sono</h3>
                <img src="./images/sabrina-profile.jpg" alt="Sabrina Onicotecnica" class="profile-image">
                <p>Ciao, sono Sabrina, e la mia passione per le unghie è nata quando ero solo una bambina.</p>
                <p>A 12 anni già sperimentavo su me stessa e sui miei parenti, e oggi quella passione è diventata il mio lavoro.</p>
                <p>Da due anni mi dedico con amore e precisione al mondo nails, con uno stile che punta all'eleganza e alla cura dei dettagli. Amo in particolare la forma a mandorla, che realizzo seguendo ogni parametro tecnico, sempre alla ricerca della perfezione.</p>
                <p>Quello che mi rende felice? Il sorriso delle mie clienti, la loro soddisfazione, e la magia di trasformare una manicure in un momento speciale per sentirsi più belle e sicure.</p>
                <p>Mi descrivono come una persona vivace, disponibile e attenta, e ci tengo a far sentire ogni cliente a proprio agio, valorizzata e coccolata.</p>
                <blockquote>
                    "La passione non si insegna, si sente — ed è quella che fa la differenza."
                </blockquote>
                <p>Ed è proprio da qui che nasce ogni mio lavoro.</p>
            </div>
        </div>
    </section>
  

   
    <footer class="site-footer">
        <p>&copy; 2025 Sabrina Onicotecnica. Tutti i diritti riservati.</p>
    </footer>

    <!-- Script per Supabase e funzionalità principali -->
    <script type="module">
        import { supabase } from './js/supabaseClient.js';

        // Funzione per caricare le date disponibili
        const loadDates = async () => {
            try {
                const { data: availability, error } = await supabase
                    .from('availability')
                    .select('date')
                    .order('date', { ascending: true }); // Ordiniamo le date

                if (error) {
                    console.error('Errore nel caricamento delle date:', error);
                    return;
                }

                const uniqueDates = [...new Set(availability.map(item => item.date))];
                const dateSelect = document.getElementById('date');
                if (dateSelect) {
                    dateSelect.innerHTML = `
                        <option value="" disabled selected>Seleziona una data</option>
                        ${uniqueDates.map(date => `
                            <option value="${date}">${date}</option>
                        `).join('')}
                    `;

                    // Se c'è una sola data disponibile, selezionala automaticamente
                    if (uniqueDates.length === 1) {
                        dateSelect.value = uniqueDates[0];
                        loadTimesForDate(uniqueDates[0]);
                    }
                }
            } catch (err) {
                console.error('Errore imprevisto durante il caricamento delle date:', err);
            }
        };

        // Funzione per caricare gli orari disponibili per una data selezionata
        const loadTimesForDate = async (selectedDate) => {
            try {
                const { data: availability, error: availabilityError } = await supabase
                    .from('availability')
                    .select('time')
                    .eq('date', selectedDate)
                    .order('time', { ascending: true }); // Ordiniamo gli orari

                if (availabilityError) {
                    console.error('Errore nel caricamento degli orari disponibili:', availabilityError);
                    return;
                }

                const { data: bookedAppointments, error: appointmentsError } = await supabase
                    .from('appointments')
                    .select('time')
                    .eq('date', selectedDate);

                if (appointmentsError) {
                    console.error('Errore nel caricamento degli appuntamenti:', appointmentsError);
                    return;
                }

                const bookedTimes = bookedAppointments.map(appointment => appointment.time);
                const filteredTimes = availability.filter(item => !bookedTimes.includes(item.time));

                const timeSelect = document.getElementById('time');
                if (timeSelect) {
                    timeSelect.innerHTML = filteredTimes.map(item => `
                        <option value="${item.time}">${item.time}</option>
                    `).join('');
                    timeSelect.disabled = false;
                }
            } catch (err) {
                console.error('Errore imprevisto durante il caricamento degli orari:', err);
            }
        };

        // Aggiungi un listener per aggiornare gli orari quando cambia la data
        const dateSelect = document.getElementById('date');
        if (dateSelect) {
            dateSelect.addEventListener('change', async (event) => {
                const selectedDate = event.target.value;
                await loadTimesForDate(selectedDate);
            });
        }

        // Funzione per gestire la prenotazione
        const bookingForm = document.getElementById('booking-form');
        if (bookingForm) {
            bookingForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                const client_name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                const date = document.getElementById('date').value;
                const time = document.getElementById('time').value;
                const notes = document.getElementById('notes').value;

                try {
                    const { error } = await supabase
                        .from('appointments')
                        .insert([{ client_name, phone, date, time, notes }]);

                    if (error) {
                        console.error('Errore durante la prenotazione:', error);
                        document.getElementById('booking-message').textContent = 'Errore durante la prenotazione. Riprova.';
                        return;
                    }

                    bookingForm.reset();
                    document.getElementById('booking-message').textContent = 'Prenotazione effettuata con successo!';
                    await loadDates();
                    await loadTimesForDate(date);
                } catch (err) {
                    console.error('Errore imprevisto durante la prenotazione:', err);
                    document.getElementById('booking-message').textContent = 'Errore imprevisto. Riprova.';
                }
            });
        }

        // Funzione per caricare i trattamenti
        async function loadTreatments() {
            try {
                const { data: treatments, error } = await supabase
                    .from('treatments')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) {
                    console.error('Errore nel caricamento dei trattamenti:', error);
                    return;
                }

                const servicesContainer = document.querySelector('.services-container');
                if (servicesContainer && treatments) {
                    servicesContainer.innerHTML = `
                        <div class="service-grid">
                            ${treatments.map(treatment => `
                                <div class="service-card">
                                    <div class="before-after-slider">
                                        <img class="before-image" src="${treatment.before_image || treatment.image_url}" alt="Prima">
                                        <div class="slider-handle"></div>
                                        <img class="after-image" src="${treatment.after_image || treatment.image_url}" alt="Dopo">
                                    </div>
                                    <h3>${treatment.name}</h3>
                                    <p>${treatment.description}</p>
                                    <p class="price">Prezzo a partire da €${treatment.price.toFixed(2)}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } catch (err) {
                console.error('Errore imprevisto:', err);
            }
        }

        // Carica i dati iniziali
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDates();
            await loadTreatments();
        });
    </script>

    <!-- Script per lo sfondo -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const backgroundImageURL = localStorage.getItem('backgroundImageURL');
                if (backgroundImageURL) {
                    document.body.style.backgroundImage = `url('${backgroundImageURL}')`;
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundPosition = 'center';
                }
            } catch (error) {
                console.error('Errore nel caricamento dello sfondo:', error);
            }
        });
    </script>

    

    
    <!-- Script per il menu mobile -->
    <script src="./js/menu.js"></script>
    <!-- Script per il before/after slider -->
    <script src="./js/slider.js"></script>

    <!-- Script per il popup -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verifica se il popup è già stato mostrato in questa sessione
            if (!sessionStorage.getItem('popupMostrato')) {
                // Mostra il popup dopo 2 secondi
                setTimeout(function() {
                    document.querySelector('.popup-overlay').classList.add('active');
                }, 2000);

                // Salva che il popup è stato mostrato
                sessionStorage.setItem('popupMostrato', 'true');
            }

            // Chiudi popup quando si clicca sulla X
            document.querySelector('.popup-close').addEventListener('click', function() {
                document.querySelector('.popup-overlay').classList.remove('active');
            });

            // Chiudi popup quando si clicca fuori
            document.querySelector('.popup-overlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>

    <!-- Gestione smooth scroll per il pulsante del popup -->
    <script>
        document.querySelector('.popup-button').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('#prenotazioni').scrollIntoView({
                behavior: 'smooth'
            });
            // Chiudi il popup dopo il click
            document.querySelector('.popup-overlay').classList.remove('active');
        });
    </script>
</body>
</html>
